---
layout: docs
---

<div class="container-fluid white-background fill-screen-minus-footer-and-nav">
  <div class="row">
    {% include authipay/docs/side-menu.html active="ws-api-card-sale" %}

    <div class="col-sm col-md-6 pt-4">
      <div class="row pl-3">
        <div class="col">
          <h1 class="page-heading">Testing Card Sale</h1>

          <div class="docs-text-block">
            <p class="text-gray">
             The <b class="fw-400"><i>Sale</i></b> operation of the Web Services API is used to authorise and immediately capture an amount from a customer's credit/debit card in one take. 
            </p>
            <p class="text-gray">
             Follow these simple steps to try out a test transaction against the <b class="fw-400"><i>Sale</i></b> simulator in your Developer Playground. We're using a simple cURL request in example code below, but the same steps apply to any language. 
            </p>
            <ul class="doc-list">
              <li>
                <a class="doc-link" href="./ws-api-1st-request.html#section-play-test-request">
                  Build the XML body
                </a>
              </li>
              <li>
                <a class="doc-link" href="./ws-api-1st-request.html#section-curl-example">
                  Submit the XML to the simulator
                </a>
              </li>
              <li>
                <a class="doc-link" href="./ws-api-1st-request.html#section-code-it">
                  Parse the response
                </a>
              </li>
            </ul>
          </div>

          {% include docs/components/text-block-divider.html %}

          <div class="docs-text-block" id="section-play-test-request">
            <h2 class="section-heading">Step 1: Build the XML body</h2>

            <p class="text-gray">
               The quickest way to see a WS API transaction? Look for the "Play Test Request" buttons on any of the simulators. This will fire an actual test request to that simulator, as if you've made the request yourself.
            </p>
              
              
              <pre class="prettyprint lang-xml prettyprinted" style=""><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;env:Envelope</span><span class="pln">
    </span><span class="atn">xmlns:xsd</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema"</span><span class="pln">
    </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
    </span><span class="atn">xmlns:v1</span><span class="pun">=</span><span class="atv">"http://ipg-online.com/ipgapi/schemas/ipgapi"</span><span class="pln">
    </span><span class="atn">xmlns:env</span><span class="pun">=</span><span class="atv">"http://schemas.xmlsoap.org/soap/envelope/"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;env:Body&gt;</span><span class="pln">
    </span><span class="tag">&lt;ipgapi:IPGApiOrderRequest</span><span class="pln">
        </span><span class="atn">xmlns:v1</span><span class="pun">=</span><span class="atv">"http://ipg-online.com/ipgapi/schemas/v1"</span><span class="pln">
        </span><span class="atn">xmlns:ipgapi</span><span class="pun">=</span><span class="atv">"http://ipg-online.com/ipgapi/schemas/ipgapi"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;v1:Transaction&gt;</span><span class="pln">
        </span><span class="tag">&lt;v1:CreditCardTxType&gt;</span><span class="pln">
          </span><span class="tag">&lt;v1:Type&gt;</span><span class="pln">sale</span><span class="tag">&lt;/v1:Type&gt;</span><span class="pln">
        </span><span class="tag">&lt;/v1:CreditCardTxType&gt;</span><span class="pln">
        </span><span class="tag">&lt;v1:CreditCardData&gt;</span><span class="pln">
          </span><span class="tag">&lt;v1:CardNumber&gt;</span><span class="pln">4111111111111111</span><span class="tag">&lt;/v1:CardNumber&gt;</span><span class="pln">
          </span><span class="tag">&lt;v1:ExpMonth&gt;</span><span class="pln">02</span><span class="tag">&lt;/v1:ExpMonth&gt;</span><span class="pln">
          </span><span class="tag">&lt;v1:ExpYear&gt;</span><span class="pln">22</span><span class="tag">&lt;/v1:ExpYear&gt;</span><span class="pln">
        </span><span class="tag">&lt;/v1:CreditCardData&gt;</span><span class="pln">
        </span><span class="tag">&lt;v1:Payment&gt;</span><span class="pln">
          </span><span class="tag">&lt;v1:ChargeTotal&gt;</span><span class="pln">19.00</span><span class="tag">&lt;/v1:ChargeTotal&gt;</span><span class="pln">
          </span><span class="tag">&lt;v1:Currency&gt;</span><span class="pln">978</span><span class="tag">&lt;/v1:Currency&gt;</span><span class="pln">
        </span><span class="tag">&lt;/v1:Payment&gt;</span><span class="pln">
      </span><span class="tag">&lt;/v1:Transaction&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ipgapi:IPGApiOrderRequest&gt;</span><span class="pln">
  </span><span class="tag">&lt;/env:Body&gt;</span><span class="pln">
</span><span class="tag">&lt;/env:Envelope&gt;</span></pre>
              
              
{% capture code_block %}{% include authipay/code/card-sale-xml-example.html %}{% endcapture %}
{% include docs/components/code-block.html content=code_block %}
            <p class="text-gray">
             Examine the request and response as they fire in real-time.
            </p>
          </div>

          <div class="doc-image-container">
            <img class="doc-image" src="/img/authipay/Sim_PlayTestRequest.gif" alt="Play Test Request">
            <p></p>
            {% include docs/components/text-block-divider.html %}
          </div>

          <div class="docs-text-block" id="section-curl-example">
            <h2 class="section-heading">Make a cURL request</h2>
            <p class="text-gray">
              Another easy way to try your own test request? Make a cURL request from your local machine to the simulator. This method is described in the "Integration" tab of every WS API sim, including copy&paste commands for you to run in a terminal/command line on your local dev machine.
            </p>

              {% include docs/components/text-block-divider.html %}

          </div>

          <div class="docs-text-block" id="section-code-it">
            <h2 class="section-heading">Code it yourself</h2>
            <p class="text-gray">The following will show you how straightforward it is to code your first transaction. In this example, we're using the WebService card <i>Sale</i> simulator.
            </p>
            <p class="text-gray">
              Whatever your coding language, first thing you will need is a library to build up an XML payload. For example, in Ruby, we use the <a class="doc-link" href="https://rubygems.org/gems/nokogiri/versions/1.6.8">Nokogiri gem</a>, which is part of the standard Ruby-on-Rails distribution.
            </p>
          </div>

          <div class="docs-card info raise dark-background mb-45">
            <div class="docs-card-body">
              <h5 class="docs-card-title text-info mb-3">
                <i class="fas fa-info-circle mr-2"></i> Our Tip: include all xmlns
              </h5>
              <p class="docs-card-text text-light">
                Make sure you include all xmlns attributes (aka XML namespaces) mentioned in this guide. Without these the XML may not be parsed correctly on the server end.
              </p>
            </div>
          </div>

          <div class="docs-text-block">
            <p class="text-gray">
              The XML body of the card <b class="fw-400"><i>Sale</i></b> has 2 main parts: (1) the CreditCardData and (2) Payment.
            </p>

            <ul class="doc-list fw-300">
              <li>
                The card data structure holds all the information about the card that your customer entered in on your checkout form and includes: the card number (PAN), expiry month, expiry year and card code value (a.k.a. CVV)
              </li>
              <li>
                The payment block has the amount to be debited ("<b class="fw-400"><i>ChargeTotal</i></b>") and the currency (currency codes follow the <a href="https://en.wikipedia.org/wiki/ISO_4217" target="_blank">ISO-4217</a>).
              </li>
            </ul>

            <p class="text-gray">
              Once you have that XML constructed, send it as a POST request to the card <b class="fw-400"><i>Sale</i></b> simulator (copy&paste the POST URL from the "Integration" tab of the simulator).
            </p>

            <p class="text-gray">
              The simulator will first validate your test request is well-formed, that is, does the XML payload have the necessary values to carry out the sale simulation? If the simulator detects any issues, it will respond with verbose validation reasons so you quickly learn what needs to change.
            </p>

            <p class="text-gray">
              Finally: your code has to handle the simulator response. It will send back an XML document that contains information about the transaction: the result from the gateway, the bank authorisation result, DCC information, etc. Your code must parse this.
            </p>

            <p class="text-gray">
              The important parameter to look for in the response is the <span class="fw-200">ApprovalCode</span>.
            </p>

            <ul class="doc-list fw-300">
              <li>If the value starts with ‘Y’, that means everything went well, and the transaction was approved. </li>
              <li>If the value here starts with an ‘N’ followed by a colon ‘:’ and a negative number, that means the transaction failed. </li>
            </ul>
          </div>

          <div class="docs-card info raise dark-background mb-45">
            <div class="docs-card-body">
              <h5 class="docs-card-title text-info mb-3">
                <i class="fas fa-info-circle mr-2"></i>Our Tip: rememer the <span class="fw-200">OrderId</span>
              </h5>
              <p class="docs-card-text text-light">
                Each transaction will get its own <span class="fw-200">OrderId</span>, which you should store internally to your systems, should you need it later for chargebacks / disputes. You can also store the IpgTransactionId as well, making sure that lookups for these disputed transactions are short when you need to contact Authipay.
              </p>
            </div>
          </div>

        </div>
      </div>

      {% include docs/components/whats-next.html
        text="Explore the Connect payment modes"
        link_href="./ws-api-1st-request"
        link_text="Test the Card Sale operation"
      %}
    </div>
  </div>
</div>
